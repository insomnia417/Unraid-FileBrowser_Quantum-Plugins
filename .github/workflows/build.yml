name: Build and Release Plugin Package

on:
  push:
    branches: [ master, main ]  # 当你向 master 或 main 分支推送代码时触发
  workflow_dispatch:           # 允许你在 GitHub 页面上手动点按钮触发

jobs:
  build:
    runs-on: ubuntu-latest    # 在最新的 Ubuntu 虚拟环境运行

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4 # 下载你的仓库代码

      - name: Setup Build Environment
        run: |
          sudo apt-get update
          sudo apt-get install -y tar xz-utils # 安装打包工具

      - name: Run Makepkg
        run: |
          # 模拟 Unraid 的 makepkg 环境
          # 创建临时构建目录
          BUILD_DIR="/tmp/fb_build"
          mkdir -p $BUILD_ROOT
          
          # 按照 ich777 的逻辑，拷贝 source 目录
          cp -RP source/* $BUILD_DIR/
          
          # 执行压缩打包 (GitHub 环境没有 makepkg 命令，我们用 tar 模拟)
          # 打包成 .txz 格式，这正是 installpkg 识别的格式
          cd $BUILD_DIR
          tar -cvJf ../filebrowser_quantum.txz .

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: plugin-package
          path: filebrowser_quantum.txz
