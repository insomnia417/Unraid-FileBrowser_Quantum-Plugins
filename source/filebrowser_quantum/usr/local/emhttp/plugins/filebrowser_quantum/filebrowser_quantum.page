Menu="&launch;"
Icon="&name;.png"
Title="&name;"
---
<?php
$name = "filebrowser_quantum";
// 获取本地版本
$current_version = shell_exec("/usr/local/emhttp/plugins/".$name."/webuiScript.sh VERSION");
// 获取远程版本
$newest_version = @file_get_contents("/tmp/".$name."_newest_version");
?>

<div style="width: 500px;">
    <table class="settings">
        <thead><tr><th colspan="2">FileBrowser Quantum 状态</th></tr></thead>
        <tr>
            <td>当前程序版本:</td>
            <td><span style="color: green; font-weight: bold;"><?= $current_version ?: "获取中..." ?></span></td>
        </tr>
        <tr>
            <td>GitHub 最新版本:</td>
            <td><span style="color: blue; font-weight: bold;"><?= $newest_version ?: "检测中..." ?></span></td>
        </tr>
        <tr>
            <td>操作:</td>
            <td>
                <input type="button" value="立即更新二进制" onclick="updateBinary()">
            </td>
        </tr>
    </table>
</div>

<script>
function updateBinary() {
    if (confirm('确定要更新二进制文件吗？\n这将停止当前服务并从 GitHub 下载最新版本。')) {
        $.post('/plugins/filebrowser_quantum/updaterclone.sh', {action:'update'}, function(data) {
            alert('更新已启动，请在 30 秒后刷新页面。');
        });
    }
}
</script>
