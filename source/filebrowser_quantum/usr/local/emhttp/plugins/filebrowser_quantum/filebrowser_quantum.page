Menu="&launch;"
Icon="&name;.png"
Title="&name;"
---
<?php
$name = "filebrowser_quantum";
// 获取本地当前版本
$current_version = shell_exec("/usr/local/emhttp/plugins/".$name."/webuiScript.sh VERSION");
// 获取由 webuiScript.sh 异步抓取的远程版本号
$newest_version = @file_get_contents("/tmp/".$name."_newest_version");
?>

<div style="width: 500px;">
    <table class="settings">
        <tr>
            <td>当前程序版本:</td>
            <td><span style="color: green; font-weight: bold;"><?= $current_version ?: "未知" ?></span></td>
        </tr>
        <tr>
            <td>GitHub 最新版本:</td>
            <td><span style="color: blue; font-weight: bold;"><?= $newest_version ?: "正在获取..." ?></span></td>
        </tr>
        <tr>
            <td>二进制文件操作:</td>
            <td>
                <input type="button" value="更新二进制文件" onclick="updateBinary()">
                <p style="font-size: 0.9em; color: #666;">* 更新将下载最新的 GitHub Release 并重启服务</p>
            </td>
        </tr>
    </table>
</div>

<script>
function updateBinary() {
    if (confirm('确认要更新 filebrowser_quantum 二进制文件吗？\n更新过程中服务将短暂停止。')) {
        // 调用 updaterclone.sh 脚本
        $.post('/plugins/filebrowser_quantum/updaterclone.sh', {action:'update'}, function(data) {
            alert('更新脚本已触发！请等待 10-30 秒后刷新页面查看新版本。');
        });
    }
}
</script>
